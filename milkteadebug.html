<!DOCTYPE html>
<html>
<head>
	<title>顯示用戶延遲時間和 IP</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<style>
		.box {
			font-size: 20px;
			font-weight: bold;
			display: inline-block;
			margin-right: 10px;
		}
	</style>
</head>
<body>
	<div>
		<span class="box">用戶 IP：</span>
		<span class="box" id="user-ip"></span>
	</div>
	<div>
		<span class="box">伺服器延遲時間：</span>
		<span class="box" id="server-latency"></span>
	</div>

	<script>
		$(document).ready(function(){

			// 獲取用戶的 IP
			function getUserIP(){
				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function(){
					if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200){
						var data = JSON.parse(xhr.responseText);
						$('#user-ip').text(data.ip);
					}
				};
				xhr.open('GET', 'https://api.ipify.org?format=json', true);
				xhr.send();
			}

			// 獲取伺服器延遲時間
			function getServerLatency(){
				var startTime = new Date().getTime();
				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function(){
					if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200){
						var endTime = new Date().getTime();
						var latency = endTime - startTime;
						$('#server-latency').text(latency + 'ms');
					}
				};
				xhr.open('GET', '/ping', true);
				xhr.send();
			}

			// 定時更新用戶 IP 和 伺服器延遲時間
			setInterval(function(){
				getUserIP();
				getServerLatency();
			}, 1000);

			// 當頁面載入完成後，立即執行一次獲取用戶 IP 和 伺服器延遲時間的函式
			getUserIP();
			getServerLatency();
		});
	</script>
</body>
</html>
